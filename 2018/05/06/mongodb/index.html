<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="MongoDB," />










<meta name="keywords" content="MongoDB">
<meta property="og:type" content="article">
<meta property="og:title" content="MongoDB">
<meta property="og:url" content="https://bengbu-yuezhang.github.io/yue.github.io/2018/05/06/mongodb/index.html">
<meta property="og:site_name" content="æ–°ä¸–ç´€ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://unsplash.it/1080/608?random">
<meta property="og:updated_time" content="2018-05-19T05:34:05.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MongoDB">
<meta name="twitter:image" content="https://unsplash.it/1080/608?random">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://bengbu-yuezhang.github.io/yue.github.io/2018/05/06/mongodb/"/>





  <title>MongoDB | æ–°ä¸–ç´€ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æ–°ä¸–ç´€ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">å‰ç«¯å°å­¦ç”Ÿ</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            ä¸»é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            æ—¶é—´è½´
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bengbu-yuezhang.github.io/yue.github.io/2018/05/06/mongodb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="å¼ è¶Š">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ–°ä¸–ç´€ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MongoDB</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘å¸ƒäº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-06T15:49:44+08:00">
                2018-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="https://unsplash.it/1080/608?random" alt="image"></p>
<a id="more"></a>
<h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><blockquote>
<p><a href="https://www.mongodb.com/" target="_blank" rel="noopener">æ–‡æ¡£åœ°å€(è‹±æ–‡)</a>ï¼Œç›®å‰mongoDBå·²ç»å‘å¸ƒäº†4.0ç‰ˆæœ¬ï¼Œç°æœ‰çš„ä¸­æ–‡æ–‡æ¡£<strong>å…¨éƒ¨è¿‡æ—¶ï¼Œè€Œä¸”è¿‡æ—¶çš„å¾ˆä¸¥é‡</strong>ï¼Œå»ºè®®çœ‹è‹±æ–‡çš„ä¸ºä¸»ã€‚å…¶å®è‹±æ–‡æ–‡æ¡£ä¹Ÿæ²¡æœ‰å¤šéš¾ã€‚</p>
</blockquote>
<h2 id="CRUDæ“ä½œ"><a href="#CRUDæ“ä½œ" class="headerlink" title="CRUDæ“ä½œ"></a>CRUDæ“ä½œ</h2><h3 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h3><p>db.é›†åˆå.API()</p>
<h4 id="insertOne"><a href="#insertOne" class="headerlink" title="insertOne"></a>insertOne</h4><blockquote>
<p>æ’å…¥å•æ¡è®°å½•</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">db.users.insertOne(&#123;</span><br><span class="line">  name: <span class="string">'æƒ£æµÂ·æ˜æ—¥é¦™Â·å…°æ ¼é›·'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="insertMany"><a href="#insertMany" class="headerlink" title="insertMany"></a>insertMany</h4><blockquote>
<p>æ’å…¥å¤šæ¡è®°å½•</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.users.inserMany([</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">'ç»«æ³¢ä¸½'</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">'æƒ£æµÂ·æ˜æ—¥é¦™Â·å…°æ ¼é›·'</span>&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h3 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h3><p>db.é›†åˆå.API(æŸ¥è¯¢æ¡ä»¶, æ›´æ–°å†…å®¹, å…·ä½“é…ç½®)</p>
<h4 id="updateOne"><a href="#updateOne" class="headerlink" title="updateOne"></a>updateOne</h4><blockquote>
<p>æ›´æ–°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€æ¡æ•°æ®</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰¾åˆ°idå¤§äº1çš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œå°†nameå­—æ®µæ›´æ–°ä¸ºæƒ£æµÂ·æ˜æ—¥é¦™Â·å…°æ ¼é›·</span></span><br><span class="line">db.users.updateOne(</span><br><span class="line">  &#123;<span class="attr">id</span>: &#123;<span class="attr">$gt</span>: <span class="number">1</span>&#125;&#125;,</span><br><span class="line">  &#123;<span class="attr">$set</span>: &#123;</span><br><span class="line">    name: <span class="string">'æƒ£æµÂ·æ˜æ—¥é¦™Â·å…°æ ¼é›·'</span></span><br><span class="line">  &#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="updateMany"><a href="#updateMany" class="headerlink" title="updateMany"></a>updateMany</h4><blockquote>
<p>æ›´æ–°æ»¡è¶³æ¡ä»¶çš„å…¨éƒ¨æ•°æ®</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// æ‰¾åˆ°idå¤§äº0çš„å…¨å±€æ•°æ®ï¼Œå°†nameå­—æ®µæ›´æ–°ä¸ºå¹¿æœ«å‡‰å­</span></span><br><span class="line">db.users.updateMany(</span><br><span class="line">  &#123;<span class="attr">id</span>: $&#123;<span class="attr">gt</span>: <span class="number">0</span>&#125;&#125;,</span><br><span class="line">  &#123;<span class="attr">$set</span>: &#123;</span><br><span class="line">    name: <span class="string">'å¹¿æœ«å‡‰å­'</span></span><br><span class="line">  &#125;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="replaceOne"><a href="#replaceOne" class="headerlink" title="replaceOne"></a>replaceOne</h4><blockquote>
<p>æ›¿æ¢æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€æ¡æ•°æ®</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// å°†idä¸º1çš„æ•°æ®ç¬¬ä¸€æ¡æ›¿æ¢</span></span><br><span class="line">db.users.replaceOne(</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">1</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">'æƒ£æµãƒ»ã‚¢ã‚¹ã‚«ãƒ»ãƒ©ãƒ³ã‚°ãƒ¬ãƒ¼'</span>&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h3><p>db.é›†åˆå.API()</p>
<h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤é›†åˆä¸­çš„å…¨éƒ¨æ•°æ®</span></span><br><span class="line">db.users.delete(&#123;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="deleteOne"><a href="#deleteOne" class="headerlink" title="deleteOne"></a>deleteOne</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤nameä¸ºç¾é‡Œçš„ç¬¬ä¸€æ¡æ•°æ®</span></span><br><span class="line">db.users.deleteOne(&#123;</span><br><span class="line">  name: <span class="string">'ç¾é‡Œ'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="deleteMany"><a href="#deleteMany" class="headerlink" title="deleteMany"></a>deleteMany</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤idå¤§äº1çš„å…¨éƒ¨æ•°æ®</span></span><br><span class="line">db.users.deleteMany(&#123;</span><br><span class="line">    id: &#123;<span class="attr">$gt</span>: <span class="number">1</span>&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Retrieve"><a href="#Retrieve" class="headerlink" title="Retrieve"></a>Retrieve</h3><blockquote>
<p>æŸ¥è¯¢æ“ä½œæ˜¯å¢åˆ æ”¹æŸ¥ä¸­æœ€ä¸ºå¤æ‚çš„</p>
</blockquote>
<h4 id="åŸºæœ¬æŸ¥è¯¢"><a href="#åŸºæœ¬æŸ¥è¯¢" class="headerlink" title="åŸºæœ¬æŸ¥è¯¢"></a>åŸºæœ¬æŸ¥è¯¢</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢é›†åˆä¸­çš„å…¨éƒ¨æ–‡æ¡£</span></span><br><span class="line">db.users.find(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢é›†åˆä¸­nameå­—æ®µåŒ…å« "php"çš„æ–‡æ¡£</span></span><br><span class="line">db.users.find(&#123;</span><br><span class="line">    name: &#123;<span class="attr">$regex</span>: <span class="regexp">/php/gi</span>&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="And-OR"><a href="#And-OR" class="headerlink" title="And OR"></a>And OR</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// andæŸ¥è¯¢ï¼Œidå¤§äº1å¹¶ä¸”nameå­—æ®µç­‰äºphpæˆ–è€…javaçš„æ–‡æ¡£</span></span><br><span class="line">db.users.find(&#123;</span><br><span class="line">    id: &#123;<span class="attr">$gt</span>: <span class="number">1</span>&#125;,</span><br><span class="line">    name: &#123;<span class="attr">$in</span>: [<span class="string">'php'</span>, <span class="string">'java'</span>]&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// oræŸ¥è¯¢ï¼ˆçŸ­è·¯orï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶æ»¡è¶³ï¼Œç¬¬äºŒä¸ªæ¡ä»¶ä¼šè¢«å¿½ç•¥ï¼‰</span></span><br><span class="line"><span class="comment">// nameå­—æ®µåŒ…å«javaæˆ–è€…c++çš„æ•°æ®</span></span><br><span class="line">db.users.find(&#123;</span><br><span class="line">    $or: [</span><br><span class="line">        &#123;<span class="attr">name</span>: &#123;<span class="attr">$regex</span>: <span class="regexp">/java/gi</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="attr">nmae</span>: &#123;<span class="attr">$regex</span>: <span class="regexp">/c++/gi</span>&#125;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="åµŒå¥—æ–‡æ¡£æŸ¥è¯¢"><a href="#åµŒå¥—æ–‡æ¡£æŸ¥è¯¢" class="headerlink" title="åµŒå¥—æ–‡æ¡£æŸ¥è¯¢"></a>åµŒå¥—æ–‡æ¡£æŸ¥è¯¢</h4><blockquote>
<p>å¯¹äºåµŒå¥—å­—æ®µçš„æŸ¥è¯¢ï¼ŒåŒ¹é…çš„æŸ¥è¯¢æ¡ä»¶çš„ä¹¦å†™æ˜¯éå¸¸ä¸¥æ ¼çš„ï¼ŒåŒ…æ‹¬å­—æ®µçš„é¡ºåºä¸€è‡´æ—¶æ‰ä¼šè¢«åŒ¹é…ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">db.users.insertMany([</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">'å¹¿æœ«å‡‰å­'</span>,</span><br><span class="line">        info: &#123;</span><br><span class="line">            birthday: <span class="number">1980</span>,</span><br><span class="line">            country: <span class="string">'æ—¥æœ¬'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">'æœ¬ç”°ç¿¼'</span>,</span><br><span class="line">        info: &#123;</span><br><span class="line">            birthday: <span class="number">1992</span>,</span><br><span class="line">            country: <span class="string">'æ—¥æœ¬'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç²¾ç¡®æŸ¥è¯¢ï¼ˆæ³¨æ„å­—æ®µçš„é¡ºåºéœ€è¦å’Œä¿å­˜æ—¶å€™çš„é¡ºåºä¸€è‡´ï¼‰</span></span><br><span class="line">db.users.find(&#123;</span><br><span class="line">    info: &#123;</span><br><span class="line">        birthday: <span class="number">1992</span>,</span><br><span class="line">        country: <span class="string">'æ—¥æœ¬'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœéœ€è¦å¯¹äºåµŒå¥—æ–‡æ¡£ï¼Œä½¿ç”¨æ¡ä»¶æŸ¥è¯¢è€Œä¸æ˜¯ç²¾ç¡®æŸ¥è¯¢ï¼Œéœ€è¦ä½¿ç”¨ç‚¹ç¬¦åˆ</span></span><br><span class="line"><span class="comment">// æŸ¥è¯¢info.birthdayå¤§äº1970çš„æ•°æ®</span></span><br><span class="line">db.users.find(&#123;</span><br><span class="line">    <span class="string">'info.birthday'</span>: &#123;<span class="attr">$gt</span>: <span class="number">1970</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‚¹ç¬¦å·é…åˆandæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">// æŸ¥è¯¢info.birthdayå¤§äº1960çš„å¹¶ä¸”info.countryä¸ºæ—¥æœ¬çš„æ•°æ®</span></span><br><span class="line">db.users.find(&#123;</span><br><span class="line">    <span class="string">'info.birthday'</span>: &#123;<span class="attr">$gt</span>: <span class="number">1960</span>&#125;,</span><br><span class="line">    <span class="string">'info.country'</span>: <span class="string">'æ—¥æœ¬'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="æ•°ç»„çš„æŸ¥è¯¢"><a href="#æ•°ç»„çš„æŸ¥è¯¢" class="headerlink" title="æ•°ç»„çš„æŸ¥è¯¢"></a>æ•°ç»„çš„æŸ¥è¯¢</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">db.games.insertMany([</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">'ä½¿å‘½å¬å”¤4'</span>, <span class="attr">tag</span>: [<span class="string">'2007'</span>, <span class="string">'æˆ˜äº‰'</span>]&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">'é»‘æš—ä¹‹é­‚3'</span>, <span class="attr">tag</span>: [<span class="string">'2016'</span>, <span class="string">'é­”å¹»'</span>]&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">'åˆºå®¢ä¿¡æ¡:èµ·æº'</span>, <span class="attr">tag</span>: [<span class="string">'2017'</span>, <span class="string">'å†å²'</span>]&#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„ä¸º2017ï¼Œå†å²çš„æ–‡æ¡£ï¼Œé¡ºåºä¹Ÿéœ€è¦ä¿è¯ä¸€è‡´ï¼Œæ‰èƒ½æ­£ç¡®çš„åŒ¹é…</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    tag: [<span class="string">'2017'</span>, <span class="string">'å†å²'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„ä¸­åŒ…å«â€˜å†å²â€™çš„æ–‡æ¡£</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    tag: &#123;</span><br><span class="line">        $all: [<span class="string">'å†å²'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤åˆæ¡ä»¶æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment">// æ•°ç»„ä¸­ä¸€ä¸ªåŒ…å«2017,å¦ä¸€ä¸ªåŒ…å«å†å²ï¼Œæˆ–è€…ä¸¤è€…éƒ½åŒ…å«çš„æ–‡æ¡£</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    tag: &#123;</span><br><span class="line">        $<span class="keyword">in</span>: [<span class="string">'2017'</span>],</span><br><span class="line">        $<span class="keyword">in</span>: [<span class="string">'å†å²'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šæ¡ä»¶æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment">// dim_cmå­—æ®µæ•°ç»„ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ å¤§äº22å°äº30</span></span><br><span class="line"><span class="keyword">var</span> cursor = db.collection(<span class="string">'inventory'</span>).find(&#123; </span><br><span class="line">  dim_cm: &#123; <span class="attr">$elemMatch</span>: &#123; <span class="attr">$gt</span>: <span class="number">22</span>, <span class="attr">$lt</span>: <span class="number">30</span> &#125; &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„ä¸­æŒ‡å®šå…ƒç´ çš„æŸ¥æ‰¾ï¼Œä½¿ç”¨ç‚¹æ“ä½œç¬¦ï¼Œç¬¬ä¸€ä½ä¸ºé­”å¹»çš„æ•°ç»„</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    <span class="string">'tag.1'</span>: <span class="string">'é­”å¹»'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„é•¿åº¦æŸ¥è¯¢ï¼Œé•¿åº¦ä¸º2çš„æ•°ç»„</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    tag: &#123;<span class="attr">$size</span>: <span class="number">2</span>&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="æ•°ç»„åµŒå¥—å¯¹è±¡çš„æŸ¥è¯¢"><a href="#æ•°ç»„åµŒå¥—å¯¹è±¡çš„æŸ¥è¯¢" class="headerlink" title="æ•°ç»„åµŒå¥—å¯¹è±¡çš„æŸ¥è¯¢"></a>æ•°ç»„åµŒå¥—å¯¹è±¡çš„æŸ¥è¯¢</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">db.games.insertMany([</span><br><span class="line">    &#123;</span><br><span class="line">        time: <span class="string">'2018'</span>,</span><br><span class="line">        games: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: <span class="string">'æˆ˜ç¥'</span>,</span><br><span class="line">                month: <span class="number">4</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                name: <span class="string">'æœ€ç»ˆå¹»æƒ³15'</span>,</span><br><span class="line">                month: <span class="number">3</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        time: <span class="string">'2017'</span>,</span><br><span class="line">        games: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: <span class="string">'ä½¿å‘½å¬å”¤14'</span>,</span><br><span class="line">                month: <span class="number">11</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                name: <span class="string">'å¹½çµè¡ŒåŠ¨ï¼šè’é‡'</span>,</span><br><span class="line">                month: <span class="number">3</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦ç²¾ç¡®åŒ¹é…(å­—æ®µé¡ºåºéƒ½éœ€è¦ç²¾ç¡®åŒ¹é…)</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    games: &#123;<span class="attr">name</span>: <span class="string">'æœ€ç»ˆå¹»æƒ³15'</span>, <span class="attr">month</span>: <span class="number">3</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹ä¸æ•°ç»„ä¸­å¯¹è±¡çš„å­—æ®µè¿›è¡ŒåŒ¹é…</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    <span class="string">'games.month'</span>: <span class="number">11</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šæŸ¥è¯¢çš„ä»æ•°ç»„çš„å“ªä¸€ä½æŸ¥è¯¢</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    <span class="string">'games.0.month'</span>: <span class="number">3</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹äºå•ä¸€å­—æ®µçš„æŸ¥è¯¢</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    <span class="string">'games.month'</span>: &#123;</span><br><span class="line">        $gt: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤åˆæ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">// æ•°ç»„ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ nameä¸ºå¹½çµè¡ŒåŠ¨ï¼šè’é‡ï¼Œmonthä¸º3</span></span><br><span class="line">db.games.find(&#123;</span><br><span class="line">    games: &#123;</span><br><span class="line">        $elemMatch: &#123;</span><br><span class="line">            name: <span class="string">'å¹½çµè¡ŒåŠ¨ï¼šè’é‡'</span>,</span><br><span class="line">            month: <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="æ–‡æœ¬çš„æŸ¥è¯¢"><a href="#æ–‡æœ¬çš„æŸ¥è¯¢" class="headerlink" title="æ–‡æœ¬çš„æŸ¥è¯¢"></a>æ–‡æœ¬çš„æŸ¥è¯¢</h4><blockquote>
<p>æ–‡æœ¬æœç´¢æ“ä½œå‰ï¼Œéœ€è¦æŒ‡å®šå¯ä»¥è¿›è¡Œæ–‡æœ¬æœç´¢çš„å­—æ®µ</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">db.stores.insert(</span><br><span class="line">   [</span><br><span class="line">     &#123; <span class="attr">_id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">"Java Hut"</span>, <span class="attr">description</span>: <span class="string">"Coffee and cakes"</span> &#125;,</span><br><span class="line">     &#123; <span class="attr">_id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">"Burger Buns"</span>, <span class="attr">description</span>: <span class="string">"Gourmet hamburgers"</span> &#125;,</span><br><span class="line">     &#123; <span class="attr">_id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">"Coffee Shop"</span>, <span class="attr">description</span>: <span class="string">"Just coffee"</span> &#125;,</span><br><span class="line">     &#123; <span class="attr">_id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">"Clothes Clothes Clothes"</span>, <span class="attr">description</span>: <span class="string">"Discount clothing"</span> &#125;,</span><br><span class="line">     &#123; <span class="attr">_id</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">"Java Shopping"</span>, <span class="attr">description</span>: <span class="string">"Indonesian goods"</span> &#125;</span><br><span class="line">   ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šé›†åˆä¸­çš„nameå­—æ®µï¼Œdescriptionå­—æ®µå¯ä»¥è¿›è¡Œæ–‡æœ¬æœç´¢çš„æ“ä½œ</span></span><br><span class="line">db.stores.createIndex( &#123; <span class="attr">name</span>: <span class="string">"text"</span>, <span class="attr">description</span>: <span class="string">"text"</span> &#125; )</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ–‡æœ¬ä¸­åŒ…å«javaæˆ–Coffee</span></span><br><span class="line">db.stores.find(&#123;</span><br><span class="line">    $text: &#123;</span><br><span class="line">        $search: <span class="string">"java Coffee"</span> <span class="comment">// search ä¼šä»¥oré€»è¾‘æœç´¢</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="bulkWrite"><a href="#bulkWrite" class="headerlink" title="bulkWrite"></a>bulkWrite</h2><blockquote>
<p>æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// é¦–å…ˆæ’å…¥nameå­—æ®µä¸ºæœ¬ç”°ç¿¼çš„æ•°æ®ï¼Œç„¶åæŸ¥è¯¢nameå­—æ®µä¸ºæœ¬ç”°ç¿¼çš„æ•°æ®ï¼Œç„¶åå°†nameå­—æ®µæ›´æ–°ä¸ºå¹¿æœ«å‡‰å­</span></span><br><span class="line">db.users.bulkWrite([</span><br><span class="line">    &#123;</span><br><span class="line">        insertOne: &#123;</span><br><span class="line">            <span class="built_in">document</span>: &#123;</span><br><span class="line">                name: <span class="string">'æœ¬ç”°ç¿¼'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        updateOne: &#123;</span><br><span class="line">            filter: &#123; <span class="attr">name</span>: <span class="string">'æœ¬ç”°ç¿¼'</span> &#125;,</span><br><span class="line">            update: &#123; <span class="attr">name</span>: <span class="string">'å¹¿æœ«å‡‰å­'</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h1 id="Mongoose"><a href="#Mongoose" class="headerlink" title="Mongoose"></a>Mongoose</h1><blockquote>
<p><a href="http://mongoosejs.com/" target="_blank" rel="noopener">æ–‡æ¡£åœ°å€(è‹±æ–‡)</a>, åŒMongoDBä¸€æ ·ï¼ŒMongooseå·²ç»å‘å¸ƒäº†5.xç‰ˆæœ¬ï¼Œç‰ˆæœ¬è¿­ä»£çš„éå¸¸å¿«ï¼Œä¸­æ–‡æ–‡æ¡£ç›®å‰æ²¡æœ‰å¤§å®¶è¿˜æ˜¯çœ‹è‹±æ–‡æ–‡æ¡£å§</p>
</blockquote>
<h2 id="SchemaTypes"><a href="#SchemaTypes" class="headerlink" title="SchemaTypes"></a>SchemaTypes</h2><blockquote>
<p>æ–°å»ºSchemaæ—¶ï¼Œä¸ºå­—æ®µåˆ›å»ºç±»å‹çº¦æŸï¼Œé»˜è®¤å€¼ï¼Œæ˜¯å¦å¿…å¡«ï¼ŒéªŒè¯å‡½æ•°ï¼Œç­‰ç­‰ã€‚å¯¹äºNumberç±»å‹è¿˜å¯ä»¥è®¾ç½®æœ€å¤§æœ€å°å€¼çš„çº¦æŸ</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// ç®€å•çš„ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> schema = mongoose.Schema(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>, <span class="comment">// ç±»å‹</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="number">1024</span>, <span class="comment">// é»˜è®¤å€¼</span></span><br><span class="line">        min: <span class="number">0</span>, <span class="comment">// æœ€å°å€¼</span></span><br><span class="line">        max: <span class="number">9999</span>, <span class="comment">// æœ€å¤§å€¼</span></span><br><span class="line">        required: <span class="literal">true</span>ï¼Œ <span class="comment">// æ˜¯å¦å¿…å¡«</span></span><br><span class="line">        validate: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;ï¼Œ <span class="comment">// éªŒè¯å™¨</span></span><br><span class="line">    &#125;,</span><br><span class="line">    list: [Buffer] <span class="comment">// å†…å®¹éƒ½æ˜¯Bufferçš„æ•°ç»„</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„ä¸¤ç‚¹ï¼š</p>
<ol>
<li>Schemaä¸­å¦‚æœå­˜åœ¨æ—¥æœŸç±»å‹ï¼Œç›´æ¥é€šè¿‡Dateçš„æ–¹æ³•ä¿®æ”¹è¯¥å­—æ®µmongooseæ˜¯ä¸ä¼šæ›´æ–°ä¿å­˜çš„ã€‚éœ€è¦é€šè¿‡markModifiedé€šçŸ¥mongooseå‘ç”Ÿäº†æ›´æ–°æ“ä½œã€‚</li>
<li>å¯¹äºæ•°ç»„ç±»å‹å¦‚æœæ²¡æœ‰æŒ‡å®šdefaultï¼Œé»˜è®¤å€¼ä¸ºç©ºæ•°ç»„</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">User.findOne(&#123;<span class="attr">id</span>: <span class="number">1</span>&#125;, (err, user) =&gt; &#123;</span><br><span class="line">  user.craateDate.setMonth(<span class="number">3</span>) <span class="comment">// mongooseæ˜¯æ— æ³•çŸ¥æ™“æ›´æ”¹çš„</span></span><br><span class="line">  user.markModified(<span class="string">'craateDate'</span>) <span class="comment">// é€šçŸ¥mongooseå‘ç”Ÿäº†æ›´æ”¹</span></span><br><span class="line">  user.save()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Connections"><a href="#Connections" class="headerlink" title="Connections"></a>Connections</h2><blockquote>
<p>mongooseé“¾æ¥åˆ°mongoDBçš„API</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤çš„ç«¯å£å·27017ï¼Œæœ¬åœ°åœ°å€127.0.0.1</span></span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://localhost/myapp'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Models"><a href="#Models" class="headerlink" title="Models"></a>Models</h2><blockquote>
<p>Modelsé€šè¿‡æˆ‘ä»¬å®šä¹‰çš„Schemaåˆ›å»ºçš„ï¼ŒModelså®ä¾‹ä¸Šæš´éœ²çš„æ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¿å­˜æ£€ç´¢æ•°æ®åº“ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯é€šè¿‡Modelså¤„ç†çš„ã€‚</p>
</blockquote>
<p>Modelsçš„é™æ€æ–¹æ³•(Model.APIname)å’Œå®ä¾‹æ–¹æ³•(Model.prototype.APIname)éå¸¸å¤šï¼Œå…·ä½“è¯·ç¿»é˜…<a href="http://mongoosejs.com/docs/api.html#Model" target="_blank" rel="noopener">APIåˆ—è¡¨</a>, ğŸ‘‡ä¸‹é¢åªæ˜¯ä¸¾ä¾‹è¯´æ˜</p>
<h3 id="åˆ›å»ºModels"><a href="#åˆ›å»ºModels" class="headerlink" title="åˆ›å»ºModels"></a>åˆ›å»ºModels</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> kittenSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  id: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Kitten = mongoose.model(<span class="string">'Tank'</span>, kittenSchema)</span><br></pre></td></tr></table></figure>
<h3 id="Modelsä¸Šçš„CRUD"><a href="#Modelsä¸Šçš„CRUD" class="headerlink" title="Modelsä¸Šçš„CRUD"></a>Modelsä¸Šçš„CRUD</h3><h4 id="åˆ›å»ºæ–‡æ¡£"><a href="#åˆ›å»ºæ–‡æ¡£" class="headerlink" title="åˆ›å»ºæ–‡æ¡£"></a>åˆ›å»ºæ–‡æ¡£</h4><blockquote>
<p>æ–‡æ¡£å°±æ˜¯Modelsçš„å®ä¾‹ï¼Œå°±æ˜¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­å…·ä½“çš„æ•°æ®</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹æ–¹æ³•</span></span><br><span class="line"><span class="comment">// model.saveä¼šå°†modelä¿å­˜åˆ°æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">const</span> Kitten = <span class="built_in">require</span>(<span class="string">'...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fluffy = <span class="keyword">new</span> Kitten(&#123; <span class="attr">name</span>: <span class="string">'fluffy'</span> &#125;)</span><br><span class="line">fluffy.save(<span class="function">(<span class="params">err, fluffy</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="comment">// Modles.createä¼šä¸ºæ¯ä¸€ä¸ªmodelè°ƒç”¨saveæ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> Kitten = <span class="built_in">require</span>(<span class="string">'...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> list = [&#123;<span class="attr">name</span>: <span class="string">'jack'</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">'jerry'</span>&#125;]</span><br><span class="line">Kitten.create(list, (err, kittens) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥è¯¢æ–‡æ¡£"><a href="#æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="æŸ¥è¯¢æ–‡æ¡£"></a>æŸ¥è¯¢æ–‡æ¡£</h4><p>å¸¸ç”¨çš„æ–¹æ³•æœ‰findï¼ŒfindById, findOne, Where</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™å‡ ç§æ–¹æ³•çš„ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> Kitten = <span class="built_in">require</span>(<span class="string">'...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢ageå¤§äº1å°äº5çš„æ–‡æ¡£</span></span><br><span class="line">Kitten.where(<span class="string">'age'</span>).$get(<span class="number">1</span>).$lte(<span class="number">5</span>).exec(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢å…¨éƒ¨æ•°æ®ï¼Œåªéœ€è¦è¿”å›nameå­—æ®µï¼Œä»ç¬¬äºŒæ¡æ•°æ®å¼€å§‹æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾5æ¡</span></span><br><span class="line">Kitten.find(&#123;&#125;, <span class="string">'name'</span>, &#123; <span class="attr">skip</span>: <span class="number">2</span>, <span class="attr">limit</span>: <span class="number">5</span> &#125;, (err, kittens) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// findById, æ ¹æ®æ–‡æ¡£çš„ObjectIdå­—æ®µæŸ¥è¯¢, ObjectIdæ˜¯mongooseé»˜è®¤æ·»åŠ çš„</span></span><br><span class="line">Kitten.findById(<span class="string">'5ae875c0f6ed7bd6883719b5'</span>, (err, kitten) =&gt; &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// findOne, æŸ¥è¯¢nameä¸ºfluffyçš„æ–‡æ¡£ï¼Œä½†æ˜¯åªè¿”å›ç¬¬ä¸€æ¡æ•°æ®</span></span><br><span class="line">Kitten.findOne(&#123;<span class="attr">name</span>: <span class="string">'fluffy'</span>&#125;, (err, kitten) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="åˆ é™¤æ–‡æ¡£"><a href="#åˆ é™¤æ–‡æ¡£" class="headerlink" title="åˆ é™¤æ–‡æ¡£"></a>åˆ é™¤æ–‡æ¡£</h4><p>å¸¸ç”¨çš„æœ‰Model.remove, Model.prototype.remove, Model.findByIdAndRemove</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// model.remove å®ä¾‹æ–¹æ³•</span></span><br><span class="line">Kitten.findById(<span class="string">'5ae875c0f6ed7bd6883719b5'</span>, (err, kitten) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="comment">// ...</span></span><br><span class="line">  kitten.remove(<span class="function">(<span class="params">err, kitten</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šé¢å¯ä»¥ç”¨findByIdAndRemoveæ–¹æ³•æ›´å¥½çš„è§£å†³</span></span><br><span class="line">Kitten.findByIdAndRemove(<span class="string">'5ae875c0f6ed7bd6883719b5'</span>, (err, kitten) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Models.remove é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="comment">// åˆ é™¤nameä¸ºjerryçš„æ–‡æ¡£</span></span><br><span class="line">Kitten.remove(&#123;<span class="attr">name</span>: <span class="string">'jerry'</span>&#125;, (err, kitten) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="æ›´æ–°æ–‡æ¡£"><a href="#æ›´æ–°æ–‡æ¡£" class="headerlink" title="æ›´æ–°æ–‡æ¡£"></a>æ›´æ–°æ–‡æ¡£</h4><p>å¸¸ç”¨çš„æ–¹æ³•æœ‰ Model.update, Model.updateOne, Model.updateMany, Model.findById  AndUpdate</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢nameä¸ºfulffyçš„æ–‡æ¡£ï¼Œå¹¶å°†nameå­—æ®µæ›´æ–°ä¸ºTom</span></span><br><span class="line">Kitten.updateMany(&#123;<span class="attr">name</span>: <span class="string">'fluffy'</span>&#125;, &#123;<span class="attr">$set</span>: &#123;<span class="attr">name</span>: <span class="string">'Tom'</span>&#125;&#125;, (err, raw) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Kitten.findByIdUpdate(<span class="string">'5ae875c0f6ed7bd6883719b5'</span>, &#123;<span class="attr">$set</span>: &#123;<span class="attr">name</span>: <span class="string">'Tom'</span>&#125;&#125;, (err, kitten) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼šupdateç­‰ä¸€ç³»åˆ—æ–¹æ³•ï¼Œè™½ç„¶å¯ä»¥æ›´æ–°æ–‡æ¡£ï¼Œä½†æ˜¯callbackçš„ç¬¬äºŒä¸ªå‚æ•°ä¸æ˜¯æ›´æ–°åçš„æ–‡æ¡£ã€‚å¦‚æœæƒ³æŠŠæ›´æ–°åçš„æ–‡æ¡£è¿”å›ï¼Œå¯ä»¥é€šè¿‡findByIdUpdateæ–¹æ³•ã€‚findByIdUpdateçš„callbackå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æ›´æ–°åçš„æ–‡æ¡£</strong></p>
<h2 id="å­æ–‡æ¡£"><a href="#å­æ–‡æ¡£" class="headerlink" title="å­æ–‡æ¡£"></a>å­æ–‡æ¡£</h2><blockquote>
<p>å¯ä»¥ç†è§£ä¸ºåµŒå¥—åœ¨æ–‡æ¡£ä¸­çš„æ–‡æ¡£ï¼Œå­æ–‡æ¡£ä¸ä¼šå•ç‹¬ä¿å­˜ï¼Œåªèƒ½ä¿å­˜çˆ¶çº§æ–‡æ¡£æ‰èƒ½ä¿å­˜å­æ–‡æ¡£</p>
</blockquote>
<h3 id="å­æ–‡æ¡£çš„å®šä¹‰"><a href="#å­æ–‡æ¡£çš„å®šä¹‰" class="headerlink" title="å­æ–‡æ¡£çš„å®šä¹‰"></a>å­æ–‡æ¡£çš„å®šä¹‰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = mongose.Schema</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fansSchema = mongoose.Schema(&#123;</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­SchemaåµŒå¥—åœ¨çˆ¶Schemaä¸­</span></span><br><span class="line"><span class="keyword">const</span> starSchema = mongoose.Schema(&#123;</span><br><span class="line">  fans: [fansSchema]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Star = mongoose.model(<span class="string">'Star'</span>, starSchema)</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºå­æ–‡æ¡£"><a href="#åˆ›å»ºå­æ–‡æ¡£" class="headerlink" title="åˆ›å»ºå­æ–‡æ¡£"></a>åˆ›å»ºå­æ–‡æ¡£</h3><blockquote>
<p>å­æ–‡æ¡£ä¸èƒ½å•ç‹¬ä¿å­˜ï¼Œå¿…é¡»è·Ÿéšçˆ¶æ–‡æ¡£æ‰èƒ½ä¿å­˜</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> stars = &#123; <span class="attr">fans</span>: [&#123;<span class="attr">name</span>: <span class="string">'æœ¬ç”°ç¿¼'</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">'å¹¿æœ«å‡‰å­'</span>&#125;] &#125;</span><br><span class="line"></span><br><span class="line">Star.create(stars, (err, stars) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="ä¸­é—´ä»¶æ‰§è¡Œçš„é¡ºåº"><a href="#ä¸­é—´ä»¶æ‰§è¡Œçš„é¡ºåº" class="headerlink" title="ä¸­é—´ä»¶æ‰§è¡Œçš„é¡ºåº"></a>ä¸­é—´ä»¶æ‰§è¡Œçš„é¡ºåº</h3><p><strong>å­æ–‡æ¡£.pre(â€˜saveâ€™), å­æ–‡æ¡£.pre(â€˜validateâ€™)ï¼Œåœ¨çˆ¶æ–‡æ¡£.pre(â€˜saveâ€™)ä¹‹å‰ï¼Œçˆ¶æ–‡æ¡£.pre(â€˜validateâ€™)ä¹‹åæ‰§è¡Œã€‚</strong></p>
<h3 id="æ›´æ–°å­æ–‡æ¡£"><a href="#æ›´æ–°å­æ–‡æ¡£" class="headerlink" title="æ›´æ–°å­æ–‡æ¡£"></a>æ›´æ–°å­æ–‡æ¡£</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢çˆ¶æ–‡æ¡£ï¼Œé€šè¿‡$pushæ›´æ–°å­æ–‡æ¡£</span></span><br><span class="line">Star.findOneAndUpdate(<span class="string">'5ae96fd7f95a0a08b7971952'</span>, &#123;</span><br><span class="line">  $push: &#123;</span><br><span class="line">    fans: [</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">'æ˜æ—¥é¦™'</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">'ç»«æ³¢ä¸½'</span> &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123;<span class="attr">new</span>: <span class="literal">true</span>&#125;, (err, star) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="åˆ é™¤å­æ–‡æ¡£"><a href="#åˆ é™¤å­æ–‡æ¡£" class="headerlink" title="åˆ é™¤å­æ–‡æ¡£"></a>åˆ é™¤å­æ–‡æ¡£</h3><p>ä¸æ›´æ–°æ“ä½œåŒç†ï¼Œé¦–å…ˆéœ€è¦æ‰¾åˆ°å¯¹åº”çš„çˆ¶æ–‡æ¡£ï¼Œç„¶åå¯¹å­æ–‡æ¡£ä½œå‡ºç›¸åº”çš„æ“ä½œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Star.findById(<span class="string">'5ae9877676c318efd42dff35'</span>, (err, star) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// åˆ é™¤å­æ–‡æ¡£çš„æ•°ç»„çš„å†…å®¹</span></span><br><span class="line">  star.fans.remove()</span><br><span class="line">  star.save(<span class="function">(<span class="params">err, star</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><ol>
<li>Validationåœ¨SchemaTypeä¸­å®šä¹‰</li>
<li>éªŒè¯æ˜¯å¼‚æ­¥é€’å½’çš„ï¼Œä¿å­˜çˆ¶æ–‡æ¡£ä¹‹å‰å­æ–‡æ¡£ä¹Ÿä¼šéªŒè¯ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯çˆ¶æ–‡æ¡£çš„saveå°†ä¼šæ¥æ”¶åˆ°é”™è¯¯</li>
<li>éªŒè¯å¯ä»¥æ˜¯è‡ªå®šä¹‰çš„éªŒè¯å‡½æ•°</li>
<li>mongooseé»˜è®¤å°†éªŒè¯æ¯ä¸ªsaveé’©å­</li>
</ol>
<h3 id="å†…ç½®çš„éªŒè¯"><a href="#å†…ç½®çš„éªŒè¯" class="headerlink" title="å†…ç½®çš„éªŒè¯"></a>å†…ç½®çš„éªŒè¯</h3><blockquote>
<p>é€šè¿‡åœ¨SchemaTypeä¸­å®šä¹‰ã€‚ä¾‹å¦‚Numberç±»å‹çš„maxï¼Œminã€‚Stringç±»å‹çš„maxlengthï¼Œminlengthï¼Œmatchï¼ˆæ­£åˆ™åŒ¹é…ï¼‰ï¼Œenumï¼ˆæšä¸¾ï¼Œå­—ç¬¦ä¸²åªèƒ½æ˜¯æšä¸¾ä¸­çš„å­—ç¬¦ä¸²ï¼‰</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> goddessSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  <span class="comment">// æœ€å°é•¿åº¦ä¸º2ï¼Œæœ€å¤§é•¿åº¦12ï¼Œå¿…å¡«</span></span><br><span class="line">  name: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    minlength: <span class="number">2</span>,</span><br><span class="line">    maxlength: <span class="number">12</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// æœ€å°ä¸º16ï¼Œæœ€å¤§ä¸º60ï¼Œå¿…å¡«</span></span><br><span class="line">  age: &#123;</span><br><span class="line">    type: <span class="built_in">Number</span>,</span><br><span class="line">    min: <span class="number">16</span>,</span><br><span class="line">    max: <span class="number">60</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="uniqueä¸æ˜¯éªŒè¯å™¨"><a href="#uniqueä¸æ˜¯éªŒè¯å™¨" class="headerlink" title="uniqueä¸æ˜¯éªŒè¯å™¨"></a>uniqueä¸æ˜¯éªŒè¯å™¨</h3><blockquote>
<p>uniqueä¿è¯äº†å­—æ®µçš„valueçš„å”¯ä¸€æ€§ï¼Œä½†å…¶æœ¬èº«ä¸æ˜¯éªŒè¯å™¨</p>
</blockquote>
<h3 id="è‡ªå®šä¹‰éªŒè¯å™¨"><a href="#è‡ªå®šä¹‰éªŒè¯å™¨" class="headerlink" title="è‡ªå®šä¹‰éªŒè¯å™¨"></a>è‡ªå®šä¹‰éªŒè¯å™¨</h3><blockquote>
<p>è‡ªå®šä¹‰éªŒè¯å™¨æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›Booleanç±»å‹çš„å€¼ï¼Œå¦‚æœæ˜¯falseä»£è¡¨éªŒè¯ä¸é€šè¿‡</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> goddessSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  phone: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    validate: &#123;</span><br><span class="line">      <span class="comment">// validatorå‡½æ•°çš„å‚æ•°æ˜¯å­—æ®µçš„valueå€¼</span></span><br><span class="line">      validator (value) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="regexp">/^[1][3,4,5,7,8][0-9]&#123;9&#125;$/</span>.test(value)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">      message: <span class="string">'æ‰‹æœºå·ç æ ¼å¼ä¸æ­£ç¡®'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="å¼‚æ­¥éªŒè¯å™¨"><a href="#å¼‚æ­¥éªŒè¯å™¨" class="headerlink" title="å¼‚æ­¥éªŒè¯å™¨"></a>å¼‚æ­¥éªŒè¯å™¨</h3><blockquote>
<p>å¼‚æ­¥éªŒè¯å™¨,å¯ä»¥æ¥æ”¶ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡çŠ¶æ€ä¸ºrejectä»£è¡¨éªŒè¯ä¸é€šè¿‡ï¼ŒresolveéªŒè¯é€šè¿‡</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> goddessSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  mail: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    validate: &#123;</span><br><span class="line">      validator (value) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">          setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            resolve(<span class="literal">false</span>)</span><br><span class="line">          &#125;, <span class="number">5</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      message: <span class="string">'é‚®ç®±é”™è¯¯:('</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="åŠ¨æ€éªŒè¯å™¨"><a href="#åŠ¨æ€éªŒè¯å™¨" class="headerlink" title="åŠ¨æ€éªŒè¯å™¨"></a>åŠ¨æ€éªŒè¯å™¨</h3><blockquote>
<p>Schemaä¸Šæš´éœ²äº†ä¸€äº›APIå¯ä»¥è®©æˆ‘ä»¬åŠ¨æ€çš„æ·»åŠ éªŒè¯å™¨</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: &#123;</span><br><span class="line">    type: <span class="built_in">Number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€è®¾ç½®Schemaä¸­nameå­—æ®µçš„type</span></span><br><span class="line">userSchema.path(<span class="string">'name'</span>, <span class="built_in">String</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€è®¾ç½®Schemaä¸­nameå­—æ®µçš„validate</span></span><br><span class="line">userSchema.path(<span class="string">'name'</span>).validate(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (value === <span class="string">'æèˆª'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="åµŒå¥—éªŒè¯å™¨"><a href="#åµŒå¥—éªŒè¯å™¨" class="headerlink" title="åµŒå¥—éªŒè¯å™¨"></a>åµŒå¥—éªŒè¯å™¨</h3><blockquote>
<p>å¯¹äºåµŒå¥—å¯¹è±¡ï¼ŒåŠ¨æ€çš„æ·»åŠ éªŒè¯å™¨æ˜¯éå¸¸æ£˜æ‰‹çš„ï¼Œå› ä¸ºæ·»åŠ éªŒè¯å™¨çš„è·¯å¾„æ˜¯ä¸å®Œæ•´çš„ã€‚è§£å†³åŠæ³•æ˜¯é€šè¿‡æŠŠåµŒå¥—çš„å¯¹è±¡ï¼Œæ‹†åˆ†ä¸ºå­æ–‡æ¡£çš„æ–¹å¼</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯çš„æ¼”ç¤º</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gameSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  info: &#123;</span><br><span class="line">    name: <span class="built_in">Number</span>,</span><br><span class="line">    year: <span class="built_in">Number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Error è·¯å¾„æ˜¯ä¸æ­£ç¡®çš„, nameå­—æ®µæ˜¯åœ¨infoå¯¹è±¡ä¸­</span></span><br><span class="line">gameSchema.path(<span class="string">'name'</span>, <span class="built_in">String</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­£ç¡®çš„æ¼”ç¤º</span></span><br><span class="line"><span class="comment">// è§£å†³åŠæ³•æŠŠåµŒå¥—çš„æ–‡æ¡£æ‹†åˆ†ä¸ºå­æ–‡æ¡£</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> infoSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: <span class="built_in">Number</span>,</span><br><span class="line">  year: <span class="built_in">Number</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gameSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  info: &#123;</span><br><span class="line">    type: infoSchema,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯å¾„æ‰æ˜¯æ­£ç¡®çš„</span></span><br><span class="line">infoSchema.path(<span class="string">'name'</span>, <span class="built_in">String</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Game = mongoose.model(<span class="string">'Game'</span>, gameSchema)</span><br></pre></td></tr></table></figure>
<h3 id="æ›´æ–°æ—¶çš„éªŒè¯å™¨âš ï¸âš ï¸âš ï¸"><a href="#æ›´æ–°æ—¶çš„éªŒè¯å™¨âš ï¸âš ï¸âš ï¸" class="headerlink" title="æ›´æ–°æ—¶çš„éªŒè¯å™¨âš ï¸âš ï¸âš ï¸"></a>æ›´æ–°æ—¶çš„éªŒè¯å™¨âš ï¸âš ï¸âš ï¸</h3><blockquote>
<p><strong>update(), findOneAndUpdate(), æ“ä½œçš„æ—¶å€™ï¼ŒéªŒè¯å™¨é»˜è®¤ä¸è¿›è¡ŒéªŒè¯çš„ï¼Œéœ€è¦é€šè¿‡é…ç½®runValidatorsä¸ºtrueï¼Œæ‰ä¼šåœ¨æ›´æ–°çš„æ—¶å€™å¼€å¯éªŒè¯</strong></p>
</blockquote>
<p>ä¸ºä»€ä¹ˆé»˜è®¤éªŒè¯å™¨æ˜¯ä¸å¼€å¯çš„ï¼Ÿ</p>
<ol>
<li>æ›´æ–°æ“ä½œçš„æ—¶å€™ï¼ŒéªŒè¯å™¨å†…éƒ¨çš„thisæŒ‡å‘ï¼Œå¹¶ä¸æ˜¯æŒ‡å‘æœ€æ–°æ›´æ–°çš„æ–‡æ¡£ï¼Œæ‰€ä»¥å¦‚æœéªŒè¯å™¨ä¸­æœ‰thisæ˜¯ä¸é€‚ç”¨äºæ›´æ–°éªŒè¯å™¨çš„</li>
<li>æ›´æ–°æ“ä½œçš„æ—¶å€™ï¼Œæ›´æ–°çš„éªŒè¯å™¨ä»…åœ¨æ›´æ–°çš„keyä¸Šè¿è¡Œï¼ˆå¦‚æœä½ åªæ˜¯æ›´æ–°nameå­—æ®µï¼Œåªä¼šéªŒè¯nameçš„éªŒè¯å™¨ï¼‰</li>
<li>æ›´æ–°éªŒè¯å™¨åªèƒ½åœ¨ä»¥ä¸‹æ“ä½œç¬¦æ‰§è¡Œ(å³ä½¿è®¾ç½®äº†runValidatorsä¸ºtrueï¼Œä¹Ÿåªèƒ½åœ¨ä»¥ä¸‹æ“ä½œç¬¦æ‰§è¡Œ)</li>
</ol>
<ul>
<li>$set, è®¾ç½®å­—æ®µ</li>
<li>$unset, åˆ é™¤å­—æ®µ</li>
<li>$push, ä¸ºæ•°ç»„å­—æ®µæ·»åŠ åç»­å†…å®¹ï¼ˆåªèƒ½é’ˆå¯¹æ•°ç»„å­—æ®µï¼‰<ul>
<li>$each, $pushçš„å­æ“ä½œç¬¦ï¼Œæ·»åŠ å†…å®¹åˆ°æ•°ç»„ä¸­</li>
<li>$slice, $pushçš„å­æ“ä½œç¬¦, ä»æ•°ç»„ç¬¬0ä½å¼€å§‹æˆªå–</li>
<li>$sort, $pushçš„å­æ“ä½œç¬¦, æ•°ç»„æ’åº</li>
<li>$position, $pushçš„å­æ“ä½œç¬¦, ä»æ•°ç»„å“ªä¸ªä½ç½®æ’å…¥</li>
</ul>
</li>
<li>$addToSet, ä¸ºæ•°ç»„æ·»åŠ å†…å®¹ï¼Œä½†æ˜¯å¦‚æœå†…å®¹å·²ç»å­˜åœ¨$addToSetä¸ä¼šåšä»»ä½•æ“ä½œï¼ˆå¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒaddToSetä¹Ÿä¼šåˆ¤æ–­æ˜¯å¦é‡å¤ï¼Œä½†æ˜¯åˆ¤æ–­çš„æ¡ä»¶æ˜¯å…·æœ‰å®Œå…¨ç›¸åŒçš„key-valueï¼Œå¹¶ä¸”å­—æ®µçš„é¡ºåºä¹Ÿè¦ä¸€æ ·ï¼‰</li>
<li>$pull, åˆ é™¤æ•°ç»„ä¸­æ¡ä»¶åŒ¹é…çš„å†…å®¹</li>
<li>$pullAll, åˆ é™¤æ•°ç»„ä¸­æ‰€æœ‰å®ä¾‹</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gameSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  info: &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      validate: &#123;</span><br><span class="line">        validator (value) &#123;</span><br><span class="line">          <span class="keyword">if</span> (value === <span class="string">'é”™è¯¯çš„'</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        message: <span class="string">'updateä¼šéªŒè¯å—?'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    year: &#123;</span><br><span class="line">      type: <span class="built_in">Number</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Game = mongoose.model(<span class="string">'Game'</span>, gameSchema)</span><br><span class="line"></span><br><span class="line"><span class="comment">// runValidatorsä¸ºfalseçš„æ—¶å€™ï¼Œæ›´æ–°æ“ä½œæ—¶å€™ä¸ä¼šç»è¿‡éªŒè¯å™¨éªŒè¯ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="comment">// å¯ä»¥æ­£ç¡®çš„æ‰§è¡Œæ›´æ–°æ“ä½œ</span></span><br><span class="line">Game.findByIdAndUpdate(<span class="string">'5aea88a2c3c255038b68fdec'</span>, &#123;</span><br><span class="line">    $set: &#123;</span><br><span class="line">        <span class="string">'info.name'</span>: <span class="string">'é”™è¯¯çš„'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;<span class="attr">new</span>: <span class="literal">true</span>, <span class="attr">runValidators</span>: <span class="literal">false</span>&#125;, (err, game) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) reject(err)</span><br><span class="line">    resolve(game)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// runValidatorsä¸ºtrueçš„æ—¶å€™, æ›´æ–°æ“ä½œæ—¶å€™ä¼šå¼ºåˆ¶éªŒè¯</span></span><br><span class="line"><span class="comment">// ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä¸èƒ½æ­£ç¡®çš„æ›´æ–°</span></span><br><span class="line">Game.findByIdAndUpdate(<span class="string">'5aea88a2c3c255038b68fdec'</span>, &#123;</span><br><span class="line">    $set: &#123;</span><br><span class="line">        <span class="string">'info.name'</span>: <span class="string">'é”™è¯¯çš„'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;<span class="attr">new</span>: <span class="literal">true</span>, <span class="attr">runValidators</span>: <span class="literal">true</span>&#125;, (err, game) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) reject(err)</span><br><span class="line">    resolve(game)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="ä¸­é—´ä»¶ï¼ˆé’©å­ï¼‰"><a href="#ä¸­é—´ä»¶ï¼ˆé’©å­ï¼‰" class="headerlink" title="ä¸­é—´ä»¶ï¼ˆé’©å­ï¼‰"></a>ä¸­é—´ä»¶ï¼ˆé’©å­ï¼‰</h2><p>ğŸ˜¢æ–‡æ¡£è¿˜æ²¡æœ‰çœ‹å®Œï¼Œç¨åè¡¥ä¸Š</p>
<h2 id="Population"><a href="#Population" class="headerlink" title="Population"></a>Population</h2><blockquote>
<p>Mongooseå°è£…äº†ä¸€ä¸ª population çš„åŠŸèƒ½ï¼Œå½“ä½ åœ¨å®šä¹‰ Schema çš„æ—¶å€™æŒ‡å®šäº†æŸä¸ª field æ˜¯å¼•ç”¨äº†å¦ä¸€ä¸ª Schema ï¼Œé‚£ä¹ˆä½ åœ¨è·å– document çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ populate æ–¹æ³•è®© Mongoose å¸®ä½ é€šè¿‡å¼•ç”¨ Schema å’Œ id æ‰¾åˆ°å…³è”çš„å¦ä¸€ä¸ª documentï¼Œå¹¶ä¸”ç”¨è¯¥ document çš„å†…å®¹æ›¿æ¢æ‰åŸæ¥å¼•ç”¨å­—æ®µçš„å†…å®¹ï¼Œä½¿å¼•ç”¨çš„ ducoment ä½¿ç”¨èµ·æ¥å°±åƒæ˜¯å†…åµŒçš„ document ä¸€æ ·æ–¹ä¾¿ã€‚</p>
</blockquote>
<h3 id="åˆ›å»ºå…³è”"><a href="#åˆ›å»ºå…³è”" class="headerlink" title="åˆ›å»ºå…³è”"></a>åˆ›å»ºå…³è”</h3><ol>
<li>æ¨èä½¿ç”¨Schema.Types.ObjectIdåˆ›å»ºå…³è”ï¼Œå¯¹åº”å…³è”çš„å­—æ®µåªä¼šä¿å­˜ObjectIdï¼ˆå¦ä¸€ä¸ªè¡¨çš„ObjectIdï¼‰</li>
<li>ä½¿ç”¨refå­—æ®µç¡®å®šå…³è”çš„Models</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ownerSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: <span class="built_in">String</span>,</span><br><span class="line">  <span class="comment">// åˆ›å»ºå¯¹Slaveçš„é›†åˆï¼Œç±»ä¼¼å¤–é”®çº¦æŸ</span></span><br><span class="line">  <span class="comment">// ownerçš„é›†åˆä¸­slaveså­—æ®µåªä¼šä¿å­˜slaveé›†åˆçš„ObjectId</span></span><br><span class="line">  slaves: [&#123; <span class="attr">type</span>: Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">'Slave'</span> &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> slaveSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Owner = mongoose.model(<span class="string">'Owner'</span>, ownerSchema)</span><br><span class="line"><span class="keyword">const</span> Slave = mongoose.model(<span class="string">'Slave'</span>, slaveSchema)</span><br></pre></td></tr></table></figure>
<h3 id="æ·»åŠ å…³è”"><a href="#æ·»åŠ å…³è”" class="headerlink" title="æ·»åŠ å…³è”"></a>æ·»åŠ å…³è”</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> owner = <span class="keyword">new</span> Owner(&#123;<span class="attr">name</span>: <span class="string">'ä¹…è¿œå¯ºæ£®ç½—'</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> slave = <span class="keyword">new</span> Slave(&#123;<span class="attr">name</span>: <span class="string">'ä¸Šæ‰ç»ƒ'</span>&#125;)</span><br><span class="line"></span><br><span class="line">slave.save(<span class="function">(<span class="params">err, s</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// mongooseä¼šè‡ªåŠ¨è§£æä¸ºobjectIdä¿å­˜åˆ°ownerçš„slavesæ•°ç»„ä¸­</span></span><br><span class="line">    <span class="comment">// Owneré›†åˆä¸­slaveså­—æ®µå°†ä¼šå­˜æœ‰slaveçš„ObjectIdä½œä¸ºå¼•ç”¨</span></span><br><span class="line">    owner.slaves.push(s)</span><br><span class="line">    owner.save(<span class="function">(<span class="params">err, h</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="comment">// ...</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥è¯¢å…³è”"><a href="#æŸ¥è¯¢å…³è”" class="headerlink" title="æŸ¥è¯¢å…³è”"></a>æŸ¥è¯¢å…³è”</h3><blockquote>
<p>mongooseä¼šè‡ªåŠ¨å°†ObjectIdæ›¿æ¢ä¸ºå¯¹åº”é›†åˆä¸­çš„æ–‡æ¡£ã€‚æŸ¥è¯¢æ“ä½œï¼ŒModelsï¼Œdocumentéƒ½æ‹¥æœ‰å¯¹åº”çš„populateæ–¹æ³•</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Query.populate</span></span><br><span class="line"><span class="comment">// æŸ¥è¯¢idä¸º5aebb8a287f5ca03508b6b23çš„æ–‡æ¡£ï¼Œå¹¶å°†slaveså­—æ®µåšpopulateæ“ä½œï¼Œåªå¡«å……nameå­—æ®µ</span></span><br><span class="line">Owner.findOne(&#123;<span class="attr">_id</span>: <span class="string">'5aebb8a287f5ca03508b6b23'</span>&#125;).populate(&#123;</span><br><span class="line">  path: <span class="string">'slaves'</span>,</span><br><span class="line">  select: <span class="string">'name'</span></span><br><span class="line">&#125;).exec(<span class="function">(<span class="params">err, owner</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// document.populate</span></span><br><span class="line">Owner.findById(<span class="string">'5aebb8a287f5ca03508b6b23'</span>, (err, owner) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// ownerå®ä¾‹åšpopulateæ“ä½œ</span></span><br><span class="line">  owner.populate(<span class="string">'slaves'</span>, (err, owner) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Models.populate</span></span><br><span class="line"></span><br><span class="line">Owner.findById(<span class="string">'5aebb8a287f5ca03508b6b23'</span>, (err, owner) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// å¯¹slaveså­—æ®µè¿›è¡Œpopulationï¼Œåªå¡«å……_idå­—æ®µ</span></span><br><span class="line">  Owner.populate(owner, &#123;</span><br><span class="line">    path: <span class="string">'slaves'</span>,</span><br><span class="line">    select: <span class="string">'_id'</span></span><br><span class="line">  &#125;, (err, owner) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Discriminators"><a href="#Discriminators" class="headerlink" title="Discriminators"></a>Discriminators</h2><blockquote>
<p>Discriminatorsæ˜¯ä¸€ç§æ¨¡å‹çš„ç»§æ‰¿æœºåˆ¶ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªæ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºæ¨¡å‹ã€‚å¯ä»¥ç±»æ¯”ä¸ºclassä¸­ç»§æ‰¿ã€‚Discriminatorsæ‹¥æœ‰åŸºç¡€æ¨¡å‹çš„å­—æ®µä»¥åŠä¸­é—´ä»¶ã€‚</p>
</blockquote>
<h3 id="Discriminatorsçš„å®ç°"><a href="#Discriminatorsçš„å®ç°" class="headerlink" title="Discriminatorsçš„å®ç°"></a>Discriminatorsçš„å®ç°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> schoolSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  schoolName: <span class="built_in">String</span></span><br><span class="line">&#125;, &#123;<span class="attr">discriminatorKey</span>: <span class="string">'kind'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> teacherSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> School = mongoose.model(<span class="string">'School'</span>, schoolSchema)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Teacherçš„æ¨¡å‹æ˜¯åŸºäºSchoolæ¨¡å‹åˆ›å»ºçš„</span></span><br><span class="line"><span class="comment">// Teacheræ¨¡å‹ä¼šæ‹¥æœ‰ä¸¤ä¸ªå­—æ®µnameä»¥åŠschoolName</span></span><br><span class="line"><span class="keyword">const</span> Teacher = School.discriminator(<span class="string">'Teacher'</span>, teacherSchema, &#123;</span><br><span class="line">  discriminatorKey: <span class="string">'kind'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Discriminatorsçš„ä¿å­˜"><a href="#Discriminatorsçš„ä¿å­˜" class="headerlink" title="Discriminatorsçš„ä¿å­˜"></a>Discriminatorsçš„ä¿å­˜</h3><blockquote>
<p>ä½¿ç”¨Discriminatoræ¨¡å‹åˆ›å»ºçš„æ–‡æ¡£ï¼Œä¸åŸºç¡€æ¨¡å‹åˆ›å»ºçš„æ–‡æ¡£éƒ½æ˜¯ä¿å­˜åœ¨mongoDBåŒä¸€ä¸ªé›†åˆä¸­</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> teacher = <span class="keyword">new</span> Teacher(&#123;</span><br><span class="line">  schoolName: <span class="string">'ç‰¡ä¸¹æ±Ÿå¸ˆèŒƒå­¦é™¢'</span>,</span><br><span class="line">  name: <span class="string">'èµµæ™¨'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> school = <span class="keyword">new</span> School(&#123;</span><br><span class="line">  schoolName: <span class="string">'ç‰¡ä¸¹æ±Ÿå¸ˆèŒƒå­¦é™¢'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">teacher.save(<span class="function">(<span class="params">err, teacher</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line">school.save(<span class="function">(<span class="params">err, school</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡db.schools.find(), å¯è§ schoolå’Œteacheréƒ½æ˜¯ä¿å­˜åœ¨åŒä¸€ä¸ªé›†åˆä¸­çš„</p>
<h3 id="Discriminatorsçš„æŸ¥è¯¢"><a href="#Discriminatorsçš„æŸ¥è¯¢" class="headerlink" title="Discriminatorsçš„æŸ¥è¯¢"></a>Discriminatorsçš„æŸ¥è¯¢</h3><blockquote>
<p>find(), count()ç­‰æ–¹æ³•ä¼šè‡ªåŠ¨çš„åŒºåˆ«ä¸åŒçš„Discriminators</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// mongooseçš„æŸ¥è¯¢æ–¹æ³•ä¼šè‡ªåŠ¨åŒºåˆ«ä¸åŒçš„Discriminators</span></span><br><span class="line">School.count(&#123;&#125;, (err, count) =&gt; &#123; &#125;)</span><br><span class="line">Teacher.count(&#123;&#125;, (err, count) =&gt; &#123; &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Discriminatorsçš„ä¸­é—´ä»¶"><a href="#Discriminatorsçš„ä¸­é—´ä»¶" class="headerlink" title="Discriminatorsçš„ä¸­é—´ä»¶"></a>Discriminatorsçš„ä¸­é—´ä»¶</h3><blockquote>
<p>Discriminatorsä¼šç»§æ‰¿åŸºç¡€æ¨¡å‹çš„ä¸­é—´ä»¶ï¼ŒDiscriminatorsä¹Ÿå¯ä»¥è®¾ç½®è‡ªå·±çš„ä¸­é—´ä»¶ï¼Œä»è€Œä¸å½±å“åˆ°åŸºç¡€æ¨¡å‹</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// åŸºäºSchoolçš„Discriminatorsä¹Ÿä¼šæ‰§è¡Œsaveçš„é’©å­ï¼Œæ‰“å°å‡ºsave</span></span><br><span class="line">schoolSchema.pre(<span class="string">'save'</span>, (next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'save'</span>)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Discriminatorsçš„å­—æ®µä¼˜å…ˆçº§"><a href="#Discriminatorsçš„å­—æ®µä¼˜å…ˆçº§" class="headerlink" title="Discriminatorsçš„å­—æ®µä¼˜å…ˆçº§"></a>Discriminatorsçš„å­—æ®µä¼˜å…ˆçº§</h3><blockquote>
<p>å½“Discriminatorså­—æ®µä¸åŸºæœ¬æ¨¡å‹å­—æ®µç›¸å†²çªçš„æ—¶å€™ã€‚Discriminatorså­—æ®µçš„ä¼˜å…ˆçº§æ˜¯å¤§äºåŸºæœ¬æ¨¡å‹çš„ä¼˜å…ˆçº§çš„ï¼Œä½†æ˜¯_idé™¤å¤–ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schoolSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  id: <span class="built_in">String</span>,</span><br><span class="line">  schoolName: <span class="built_in">String</span></span><br><span class="line">&#125;, &#123;<span class="attr">discriminatorKey</span>: <span class="string">'kind'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> teacherSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  id: <span class="built_in">Number</span>,</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> School = mongoose.model(<span class="string">'School'</span>, schoolSchema)</span><br><span class="line"><span class="keyword">const</span> Teacher = School.discriminator(<span class="string">'Teacher'</span>, teacherSchema, &#123;</span><br><span class="line">  discriminatorKey: <span class="string">'kind'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºç¡€æ¨¡å‹ä¸­idä¸ºStringç±»å‹ï¼ŒDiscriminatorsæ¨¡å‹ä¸­idä¸ºNumberç±»å‹ï¼ŒDiscriminatorsæ¨¡å‹çš„å­—æ®µä¼˜å…ˆçº§å¤§äºåŸºç¡€æ¨¡å‹</span></span><br><span class="line"><span class="keyword">const</span> teacher1 = <span class="keyword">new</span> Teacher(&#123;</span><br><span class="line">  schoolName: <span class="string">'ç‰¡ä¸¹æ±Ÿå¸ˆèŒƒå­¦é™¢'</span>,</span><br><span class="line">  name: <span class="string">'èµµæ™¨'</span>,</span><br><span class="line">  id: <span class="number">1</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> teacher2 = <span class="keyword">new</span> Teacher(&#123;</span><br><span class="line">  schoolName: <span class="string">'å—äº¬ç¤ºèŒƒå­¦é™¢'</span>,</span><br><span class="line">  name: <span class="string">'å®‹æ•'</span>,</span><br><span class="line">  id: <span class="string">'1'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€åä¿å­˜idå°†ä¼šä¿å­˜ä¸ºNumberç±»å‹</span></span><br><span class="line">teacher1.save(<span class="function">(<span class="params">err, teacher</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">typeof</span> teacher.id === <span class="built_in">Number</span>) <span class="comment">// true</span></span><br><span class="line">teacher2.save(<span class="function">(<span class="params">err, teacher</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">typeof</span> teacher.id === <span class="built_in">String</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h3 id="Discriminatorsä¸Model-createæ“ä½œ"><a href="#Discriminatorsä¸Model-createæ“ä½œ" class="headerlink" title="Discriminatorsä¸Model.createæ“ä½œ"></a>Discriminatorsä¸Model.createæ“ä½œ</h3><blockquote>
<p>mongooseä¼šé€šè¿‡æ•°æ®çš„DiscriminatorsKeyå­—æ®µä¹Ÿå°±æ˜¯kindï¼Œä¿å­˜ä¸ºä¸åŒçš„ç±»å‹</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸åŒçš„Discriminatorsä»¥åŠä¸åŒçš„DiscriminatorsKey</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> teacherSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  id: <span class="built_in">Number</span>,</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> studentSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  id: <span class="built_in">Number</span>,</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> janitorSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  id: <span class="built_in">Number</span>,</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Teacher = School.discriminator(<span class="string">'Teacher'</span>, teacherSchema, &#123;</span><br><span class="line">  discriminatorKey: <span class="string">'kind'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Student = School.discriminator(<span class="string">'Student'</span>, studentSchema, &#123;</span><br><span class="line">  discriminatorKey: <span class="string">'kind'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Janitor = School.discriminator(<span class="string">'Janitor'</span>, janitorSchema, &#123;</span><br><span class="line">  discriminatorKey: <span class="string">'kind'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// mongooseä¼šæ ¹æ®ä¸åŒkindï¼Œä¿å­˜æ­£ç¡®çš„ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> lists = [</span><br><span class="line">  &#123;<span class="attr">kind</span>: <span class="string">'Teacher'</span>, <span class="attr">id</span>: <span class="number">8</span>, <span class="attr">name</span>: <span class="string">'æ˜æ—¥é¦™'</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">kind</span>: <span class="string">'Student'</span>, <span class="attr">id</span>: <span class="number">9</span>, <span class="attr">name</span>: <span class="string">'ç»«æ³¢ä¸½'</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">kind</span>: <span class="string">'Janitor'</span>, <span class="attr">id</span>: <span class="number">10</span>, <span class="attr">name</span>: <span class="string">'è‘›åŸç¾é‡Œ'</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">School.create(lists, (err, schools) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MongoDB/" rel="tag"># MongoDB</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/08/http3/" rel="next" title="httpåè®®åŸºç¡€çŸ¥è¯†(3)">
                <i class="fa fa-chevron-left"></i> httpåè®®åŸºç¡€çŸ¥è¯†(3)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/19/Authentication/" rel="prev" title="ç®€å•çš„åç«¯é‰´æƒ">
                ç®€å•çš„åç«¯é‰´æƒ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ä½œè€…æ¦‚è¿°
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="å¼ è¶Š" />
            
              <p class="site-author-name" itemprop="name">å¼ è¶Š</p>
              <p class="site-description motion-element" itemprop="description">æ‰€è°“æˆé•¿ï¼Œå°±æ˜¯ç»è¿‡ä¸æ–­çš„èšæ•£ç¦»åˆï¼Œæ‰¾åˆ°ä¸å¤ªä¼šä¼¤å®³åˆ°å½¼æ­¤çš„è·ç¦»</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">57</span>
                  <span class="site-state-item-name">ç¯‡æ–‡ç« </span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">Tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/BengBu-YueZhang" target="_blank" title="æˆ‘çš„GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>æˆ‘çš„GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/5460100952/profile?topnav=1&wvr=6" target="_blank" title="æˆ‘çš„å¾®åš">
                      
                        <i class="fa fa-fw fa-globe"></i>æˆ‘çš„å¾®åš</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MongoDB"><span class="nav-number">1.</span> <span class="nav-text">MongoDB</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CRUDæ“ä½œ"><span class="nav-number">1.1.</span> <span class="nav-text">CRUDæ“ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Create"><span class="nav-number">1.1.1.</span> <span class="nav-text">Create</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#insertOne"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">insertOne</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#insertMany"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">insertMany</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update"><span class="nav-number">1.1.2.</span> <span class="nav-text">Update</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#updateOne"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">updateOne</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#updateMany"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">updateMany</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#replaceOne"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">replaceOne</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Delete"><span class="nav-number">1.1.3.</span> <span class="nav-text">Delete</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#delete"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">delete</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#deleteOne"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">deleteOne</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#deleteMany"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">deleteMany</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Retrieve"><span class="nav-number">1.1.4.</span> <span class="nav-text">Retrieve</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#åŸºæœ¬æŸ¥è¯¢"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">åŸºæœ¬æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#And-OR"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">And OR</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åµŒå¥—æ–‡æ¡£æŸ¥è¯¢"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">åµŒå¥—æ–‡æ¡£æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ•°ç»„çš„æŸ¥è¯¢"><span class="nav-number">1.1.4.4.</span> <span class="nav-text">æ•°ç»„çš„æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ•°ç»„åµŒå¥—å¯¹è±¡çš„æŸ¥è¯¢"><span class="nav-number">1.1.4.5.</span> <span class="nav-text">æ•°ç»„åµŒå¥—å¯¹è±¡çš„æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ–‡æœ¬çš„æŸ¥è¯¢"><span class="nav-number">1.1.4.6.</span> <span class="nav-text">æ–‡æœ¬çš„æŸ¥è¯¢</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bulkWrite"><span class="nav-number">1.2.</span> <span class="nav-text">bulkWrite</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mongoose"><span class="nav-number">2.</span> <span class="nav-text">Mongoose</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SchemaTypes"><span class="nav-number">2.1.</span> <span class="nav-text">SchemaTypes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Connections"><span class="nav-number">2.2.</span> <span class="nav-text">Connections</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Models"><span class="nav-number">2.3.</span> <span class="nav-text">Models</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ›å»ºModels"><span class="nav-number">2.3.1.</span> <span class="nav-text">åˆ›å»ºModels</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modelsä¸Šçš„CRUD"><span class="nav-number">2.3.2.</span> <span class="nav-text">Modelsä¸Šçš„CRUD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#åˆ›å»ºæ–‡æ¡£"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">åˆ›å»ºæ–‡æ¡£</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æŸ¥è¯¢æ–‡æ¡£"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">æŸ¥è¯¢æ–‡æ¡£</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åˆ é™¤æ–‡æ¡£"><span class="nav-number">2.3.2.3.</span> <span class="nav-text">åˆ é™¤æ–‡æ¡£</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ›´æ–°æ–‡æ¡£"><span class="nav-number">2.3.2.4.</span> <span class="nav-text">æ›´æ–°æ–‡æ¡£</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å­æ–‡æ¡£"><span class="nav-number">2.4.</span> <span class="nav-text">å­æ–‡æ¡£</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å­æ–‡æ¡£çš„å®šä¹‰"><span class="nav-number">2.4.1.</span> <span class="nav-text">å­æ–‡æ¡£çš„å®šä¹‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ›å»ºå­æ–‡æ¡£"><span class="nav-number">2.4.2.</span> <span class="nav-text">åˆ›å»ºå­æ–‡æ¡£</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸­é—´ä»¶æ‰§è¡Œçš„é¡ºåº"><span class="nav-number">2.4.3.</span> <span class="nav-text">ä¸­é—´ä»¶æ‰§è¡Œçš„é¡ºåº</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ›´æ–°å­æ–‡æ¡£"><span class="nav-number">2.4.4.</span> <span class="nav-text">æ›´æ–°å­æ–‡æ¡£</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ é™¤å­æ–‡æ¡£"><span class="nav-number">2.4.5.</span> <span class="nav-text">åˆ é™¤å­æ–‡æ¡£</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#éªŒè¯"><span class="nav-number">2.5.</span> <span class="nav-text">éªŒè¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å†…ç½®çš„éªŒè¯"><span class="nav-number">2.5.1.</span> <span class="nav-text">å†…ç½®çš„éªŒè¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uniqueä¸æ˜¯éªŒè¯å™¨"><span class="nav-number">2.5.2.</span> <span class="nav-text">uniqueä¸æ˜¯éªŒè¯å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è‡ªå®šä¹‰éªŒè¯å™¨"><span class="nav-number">2.5.3.</span> <span class="nav-text">è‡ªå®šä¹‰éªŒè¯å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¼‚æ­¥éªŒè¯å™¨"><span class="nav-number">2.5.4.</span> <span class="nav-text">å¼‚æ­¥éªŒè¯å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åŠ¨æ€éªŒè¯å™¨"><span class="nav-number">2.5.5.</span> <span class="nav-text">åŠ¨æ€éªŒè¯å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åµŒå¥—éªŒè¯å™¨"><span class="nav-number">2.5.6.</span> <span class="nav-text">åµŒå¥—éªŒè¯å™¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ›´æ–°æ—¶çš„éªŒè¯å™¨âš ï¸âš ï¸âš ï¸"><span class="nav-number">2.5.7.</span> <span class="nav-text">æ›´æ–°æ—¶çš„éªŒè¯å™¨âš ï¸âš ï¸âš ï¸</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸­é—´ä»¶ï¼ˆé’©å­ï¼‰"><span class="nav-number">2.6.</span> <span class="nav-text">ä¸­é—´ä»¶ï¼ˆé’©å­ï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Population"><span class="nav-number">2.7.</span> <span class="nav-text">Population</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ›å»ºå…³è”"><span class="nav-number">2.7.1.</span> <span class="nav-text">åˆ›å»ºå…³è”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ·»åŠ å…³è”"><span class="nav-number">2.7.2.</span> <span class="nav-text">æ·»åŠ å…³è”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æŸ¥è¯¢å…³è”"><span class="nav-number">2.7.3.</span> <span class="nav-text">æŸ¥è¯¢å…³è”</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Discriminators"><span class="nav-number">2.8.</span> <span class="nav-text">Discriminators</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Discriminatorsçš„å®ç°"><span class="nav-number">2.8.1.</span> <span class="nav-text">Discriminatorsçš„å®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discriminatorsçš„ä¿å­˜"><span class="nav-number">2.8.2.</span> <span class="nav-text">Discriminatorsçš„ä¿å­˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discriminatorsçš„æŸ¥è¯¢"><span class="nav-number">2.8.3.</span> <span class="nav-text">Discriminatorsçš„æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discriminatorsçš„ä¸­é—´ä»¶"><span class="nav-number">2.8.4.</span> <span class="nav-text">Discriminatorsçš„ä¸­é—´ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discriminatorsçš„å­—æ®µä¼˜å…ˆçº§"><span class="nav-number">2.8.5.</span> <span class="nav-text">Discriminatorsçš„å­—æ®µä¼˜å…ˆçº§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discriminatorsä¸Model-createæ“ä½œ"><span class="nav-number">2.8.6.</span> <span class="nav-text">Discriminatorsä¸Model.createæ“ä½œ</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å¼ è¶Š</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
